{% extends 'shop/base.html' %}
{% load static %}

{% block title %} MyStore.Com {% endblock %}

{% block css %}
<style>
    body .no-padding {
        padding-left: 0;
        padding-right: 0;
    }


    .col-md-3 {
        display: inline-block;
        margin-left: -4px;
    }

    .carousel-indicators .active {
        background-color: blue;
    }

    .col-md-3 img {
        width: 100%;
        height: 200px;

    }

    body .carousel-indicator li {
        background-color: aquamarine;
    }

    body .carousel-indicators {
        bottom: 0;
    }

    .carousel-control-prev-icon,
    .carousel-control-next-icon {
        background: black no-repeat center center;
        color: white;
    }

    .carousel-control-prev,
    .carousel-control-next {
        top: auto;
        bottom: auto;
        margin: 180px -50px;
    }
</style>
{% endblock %}



{% block body %}


<div class="carousel-container">

    {% for product,range, nSlides in allProds %}

    <!--Product = <QuerySet [<Product: watch>, <Product: T.V>, <Product: printer>, <Product: bluetooth>, <Product: hp Laptop>]> -->
    <!-- range = range(1, 3) -->
    <!-- nslide = 3 -->

    <h3 class="my-4">Boht Hard Sale On <strong>{{ product.0.category }}</strong> -- Purchase Quickly</h3>
    <div class="row">
    <div id="demo{{forloop.counter}}" class="col carousel slide my-3" data-ride='carousel'>

        <ul class="carousel-indicators">
            <li class="active" data-target="#demo{{forloop.counter}}" data-slide-to="0"></li>

            {% for i in range %}
            <!-- range is a tuple -->
            <li data-target="#demo{{forloop.parentloop.counter}}" data-slide-to="{{ i }}">{{ i }}</li>
            {% endfor %}

        </ul>

        <!-- slideshow starts form here -->

        <div class="carousel-inner">

            <div class="carousel-item active">

                {% for i in product %}
                <div class="col-xs-3 col-sm-3 col-md-3">
                    <div class="card" style="width: 18rem;">
                        <img src="/media/{{ i.prod_image }}" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title"> {{ i.prod_name }} ,{{ i.id }},IN i loop</h5>
                            <p class="card-text"> {{ i.desc | slice:'1:10'}}...,{{ forloop.counter }} </p>
                            <button href="#" class="btn btn-success cart" id="pr{{ i.id }}">Add To Cart</button>

                            <a href="/productview/{{ i.id }}" class="btn btn-primary cart" id="pr{{ i.id }}">View</a>

                        </div>
                    </div>
                </div>

                {% if forloop.counter|divisibleby:4 and forloop.counter > 0 and  not forloop.last %}
            </div>
            <div class="carousel-item">
                {% endif %}

            {% endfor %}
            </div>
            </div>



            <!-- next and prev slide icons -->
        </div>
        <a class="carousel-control-prev" href="#demo{{ forloop.counter }}" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"> < </span>
                    <!-- <span class="sr-only">Previous</span> -->
        </a>

        <a class="carousel-control-next" href="#demo{{forloop.counter}}" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"> > </span>
            <!-- <span class="sr-only">Next</span> -->
        </a>
            </div>  
        {% endfor %}
    </div>
    {% endblock  %}

    {% block js %}
    <script>
        console.log('working')
        if (localStorage.getItem('cart') == null) {
            var cart = {};
        }
        else 
        {
            cart = JSON.parse(localStorage.getItem('cart'));
            document.getElementById('cart_no').innerHTML = Object.keys(cart).length;
        }

        $('.cart').click(function(){

            let idStr = this.id.toString();
 
            // { key = id of btn(pr1,pre) : value = times clicked btn}
            if (cart[idStr] != undefined){
                cart[idStr] += 1; 
            }
            else{
                cart[idStr] = 1; 
            }
            console.log(cart)
            localStorage.setItem('cart' , JSON.stringify(cart));
            document.getElementById('cart_no').innerHTML = Object.keys(cart).length;

        });
    </script>

    {% endblock %}